图片处理 demo
文章是 Web Fundamentals-性能-加载性能.md 的图形内容的内容扩展

1. 具备功能
   1. 图片上传
      1. client 使用 vue 和 axios，server 使用 nodejs，使用 koa2,koa-router,koa-static
      2. web 加入上传进度和图片预览
         图片预览使用 FileReader
      3. axios 进行文件上传需要注意
         1. 添加请求头。headers: { "Content-Type": "multipart/form-data" }
         2. onUploadProgress 是上传进度的关键函数
         3. 使用 formData 传递 file
   2. 图片类型过滤外加图片本地存储
      1. 后端类型校验
      2. 为了接受文件数据，并且本地保存，使用 koa-multer 中间件，它基于 multer,但是采用了 promise。
         因为 multer 的文档全面，但是 koa-multer 基本无文档，所以需要参考 multer 的文档（https://github.com/expressjs/multer/blob/master/doc/README-zh-cn.md）【git】
      3. koa-multer 的错误处理是关键，与 multer 的写法完全不同，通过 console.log 打印关键对象才分析出来的，问题关键就是是否使用了 promise，详细解释看 DEMO(test/pic 的 upload.js)
      4. 我把图片处理也做成了中间件，但是没考虑中间件传参问题，因为 demo 的重点不在这。
   3. 压缩图片以及查看图片元数据exif
      1. 图片上传通过 koa-body
         http://www.ptbird.cn/koa-body.html【koa2 使用 koa-body 代替 koa-bodyparser 和 koa-multer】
         注意：koa-body 与 koa-bodyparser 和 koa-multer 都不兼容，后期我改为 koa-body 处理
      2. 图片存储需要考虑目录不存在的问题
      3. exif.js 负责查看图片的元数据（exif）
         http://code.ciaoca.com/javascript/exif-js/【Exif.js 读取图像的元数据】，这个是 html 的，真正 nodejs 中的用其他插件，这里不是重点不关注
      4. tiny 负责压缩图片，包括 png 和 jpg
         经过测试，tiny的压缩图片也存在些许失真的情况，需要权衡，但是压缩效率的确很高
         API 需要 key，而且申请不支持 QQ 邮箱
         https://tinypng.com/【tiny在线压缩官网】accout:zhier1991
         https://tinypng.com/developers【tiny API】
         https://www.npmjs.com/package/gulp-tinypng-nokey【模拟用户上传和下载的行为，来得到压缩图片，突破使用tiny官网api每月500张限制】
         https://segmentfault.com/a/1190000015467084【nodejs 全自动使用 Tinypng （免费版，无需任何配置）压缩图片】
         https://blog.wxhbts.com/tinypng.html【tiny，这份资料或许以后用得到】
         1. tiny nodejs 的 API 并不全面，需要通过源码推测，源码看支持 callback 和 promise 两种方式，
            而且 size 是要单独请求获得的，这划不来，采用 toFile 的回调 fs.statSync(optimizedFilePath).size 去获得效果会好很多，也可以 toBuffer 的回调 fs.writeFileSync(optimizedFilePath, u8a)去写入，这样的好处是文件名带有 size
            具体的性能细节可以后期在测试
         2. 也可以不保存源文件，直接使用 tmp 的 file.path 去压缩图片
         3. pipe 是异步操作，要 finish 方法中使用 tiny 的压缩，否则大概率出错：Error: Input file is empty (HTTP 400/InputMissing
            另外记住异常处理，catch 出错
         4. tiny 似乎相同图片的压缩不累加压缩数量，很人性化，但是不知道怎么判断是否是相同图片的。
         5. demo中加入cmd命令，可以模拟浏览器请求越过API的每月500张限制，而且压缩速度更快。
            1. 模拟tiny浏览器的压缩图片HTTP请求，掌握根据network获取重要的请求信息和请求头信息，掌握将原图转二进制传参，掌握接受和分析接口响应数据
            2. 掌握根据url下载图片到本地，还有获取文件名的小技巧path.basename(imgpath, path.extname(imgpath))
   4. 图片转 webp
      https://www.jianshu.com/p/66ea1c37c2fe【JavaScript自动转换淘宝图片格式.webp】
      https://www.imqianduan.com/nodejs/246.html【nodejs应用转换png,jpg,gif为webp图片格式】
      https://www.cnblogs.com/season-huang/p/5804884.html【webp图片实践之路】
   6. 图片预览，兼容 webp 的支持
   7. 可能的话加入图片裁剪
